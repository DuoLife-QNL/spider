# 数据预处理
## 链家新房数据预处理

### 字段信息
1. ```name```：房源名称
2. ```lotation1``` ```location2``` ```location3```：房源地理位置的三个字段
3. ```room_type```：房型
4. ```area```：面积（选取最小面积，单位：m^2）
5. ```total_price```：房源的总价（单位：万元)
6. ```avg_price```：房源的均价。对于均价确实的房源并未进行处理，原因是经验证后发现其它房源的均价并不是总价/平均面积，故认为无法通过房源的总价和面积信息计算出来房源的均价（单位：元/平）

### 程序源码
#### 爬虫内容
在数据爬取过程中完成数据预处理，通过处理字符串保留每个字段数据中期望得到的内容
```python
import scrapy
from hw.items import LianJiaItem # 引入item对象

class LianJiaSpider(scrapy.Spider):
    name = 'lianjia'
    allowed_domains = ['bj.fang.lianjia.com']
    start_urls = []
    for x in range(1, 21):
        url = 'https://bj.fang.lianjia.com/loupan/nhs1pg{}/'.format(x)
        start_urls.append(url)
    
    def parse(self, response):
        item = LianJiaItem()
        # /html/body/div[4]/ul[2]/li[2]/div/div[1]/a            [name]
        # /html/body/div[4]/ul[2]/li[2]/div/div[6]/div/span[1]  [price]
        # /html/body/div[4]/ul[2]/li[1]/div/div[3]/span         [area]
        # /html/body/div[4]/ul[2]/li[1]/div/div[2]/span[1]      [location1]
        # /html/body/div[4]/ul[2]/li[1]/div/div[2]/span[2]      [location2]
        # /html/body/div[4]/ul[2]/li[1]/div/div[2]/a            [location3]
        # /html/body/div[4]/ul[2]/li[1]/div/a/span[1]           [room_type]
        # /html/body/div[4]/ul[2]/li[1]/div/div[6]/div[2]       [total_price]
        for each in response.xpath('/html/body/div[4]/ul[2]/li'):
            # name
            item['name'] = each.xpath('div/div[1]/a/text()').get()
            # locationn
            item['location1'] = each.xpath('div/div[2]/span[1]/text()').get()
            item['location2'] = each.xpath('div/div[2]/span[2]/text()').get()
            item['location3'] = each.xpath('div/div[2]/a/text()').get()
            # room_type
            item['room_type'] = each.xpath('div/a/span[1]/text()').get()
            if item['room_type'] is None:
                item['room_type'] = ''
            # area
            area = each.xpath('div/div[3]/span/text()').get()
            if area:
                area = area.split(' ')[1].split('-')[0]
                i = filter(str.isdigit, list(area))
                item['area'] = ''.join(list(i))
            else:
                item['area'] = ''
            # total_price
            origin_total_price = each.xpath('div/div[6]/div[2]/text()').get()
            if origin_total_price:
                i = filter(str.isdigit, list(origin_total_price))
                total_price = ''.join(list(i))    
                item['total_price'] = total_price
            else:
                item['total_price'] = ''
            # average price
            unit = each.xpath('div/div[6]/div/span[2]/text()').get()
            if unit:
                unit = unit.split('(')[1].split(')')[0]
                if unit == '总价':
                    item['avg_price'] = ''
                elif unit == '均价':
                    avg_price = int(each.xpath('div/div[6]/div/span[1]/text()').get()) / 10000
                    item['avg_price'] = "{:.4f}".format(avg_price)
            else:
                item['avg_price'] = ''
            # item['price'] = each.xpath('div/div[6]/div/span[1]/text()').get() + each.xpath('div/div[6]/div/span[2]/text()').get()
            # if (item['name'] or item['price'] or item['area']):
            yield(item)
```
#### pipelines.py
由```Hwpipelines```类的实例对象将数据直接写入csv文件
```python
# -*- coding: utf-8 -*-

# Define your item pipelines here
#
# Don't forget to add your pipeline to the ITEM_PIPELINES setting
# See: https://doc.scrapy.org/en/latest/topics/item-pipeline.html

import json

class HwPipeline(object):

    def open_spider(self, spider):
        try: #打开 json 文件
            self.file = open('Data.csv', "a", encoding="utf 8")
        except Exception as err:
            print(err)
    def process_item (self, item, spider):
        # dict_item = dict(item) #生成字典对象
        # json_str = json.dumps(dict_item, ensure_ascii =False) + "\n" #生成json 串
        # self.file.write(json_str) #将 json 串写入到文件中
        self.file.write('"{}",'.format(item['name']))
        self.file.write('"{}",'.format(item['location1']))
        self.file.write('"{}",'.format(item['location2']))
        self.file.write('"{}",'.format(item['location3']))
        self.file.write('"{}",'.format(item['room_type']))
        self.file.write('"{}",'.format(item['area']))
        self.file.write('"{}",'.format(item['total_price']))
        self.file.write('"{}"\n'.format(item['avg_price']))
        return item
    def close_spider(self,spider):
        self.file.close() #关闭文件
```
#### 程序入口```begin.py```
在入口脚本中写入csv文件的头部（key），并执行爬虫指令
```python
from scrapy import cmdline

with open('Data.csv', 'w') as f:
    f.write('"name","location1","location2","location3","room_type","area","total_price","avg_price"\n')

cmdline.execute('scrapy crawl lianjia'.split())
```

### 数据爬取结果
#### 文件概览

![image-20191130112820587](C:\Users\speci\AppData\Roaming\Typora\typora-user-images\image-20191130112820587.png)

#### 文件全部内容
```
"name","location1","location2","location3","room_type","area","total_price","avg_price"
"奥园北京源墅","密云","密云其它","北京市密云区溪翁庄镇","3室","120","370",""
"首开保利欢乐大都汇","门头沟","冯村","石门营环岛北50米","","","","6.5000"
"燕西华府","丰台","丰台其它","王佐镇青龙湖公园东1500米, 泉湖西路1号院（七区）, 泉湖西路1号院（六区）","4室","195","2200","5.2000"
"中昂时代广场","门头沟","大峪","门头沟路9号博物馆对面","","","","10.0000"
"北京城建·龙樾西山","门头沟","冯村","长安街西延线南约300米","3室","118","630","5.5000"
"华远和墅","大兴","大兴其它","南六环磁各庄桥沿南中轴向南2公里","","","",""
"玺萌壹號院","丰台","草桥","西南三环嘉园路与镇国寺北街交叉口","5室","457","4500","9.9500"
"首开住总熙悦安郡","朝阳","成寿寺","南三环外成寿寺路西晨曦幼儿园对面","3室","83","875","7.9500"
"中铁华侨城和园","大兴","瀛海","南五环南海子公园西侧约500米","2室","121","810","5.5000"
"中海北京世家","大兴","亦庄开发区其它","三海子东路与公园北环路交叉口(南海子公园北侧)","4室","280","1800",""
"天恒京西悦府","房山","阎村","燕房线阎村地铁站东南角约189米","","","","3.8000"
"尚峯壹號","顺义","顺义其它","中央别墅北区京承高速11号出口, 天承环路8号院","1室","107","","3.6000"
"林肯公园二期B区","亦庄开发区","亦庄","文化园西路8号院","","","","4.0000"
"合景中心","通州","武夷花园","滨河中路和新华大街交汇处西南角，往南200米","2室","77","480","6.5000"
"燕西华府","丰台","丰台其它","王佐镇青龙湖公园东1500米, 泉湖西路1号院（七区）, 泉湖西路1号院（六区）","4室","60","650","4.9800"
"远洋新天地","门头沟","门头沟其它","长安街西延线与滨河路南延交汇处（东南侧）","","","","7.0000"
"天恒水岸壹号","房山","良乡","良乡大学城西站地铁南侧400米，刺猬河旁","2室","108","500",""
"首创远洋禧瑞天著","亦庄开发区","通州其它","科创十一街与经海九路交汇处西南角（亦庄线次渠南站200米）","2室","89","430","5.2695"
"首开璞瑅公馆","丰台","方庄","紫芳园五区","4室","236","2500","10.6000"
"远洋长安国际中心","门头沟","门头沟其它","长安街西延线与滨河路南延交汇处（东南侧）","1室","1118","","3.3000"
"北京书院","朝阳","惠新西街","北三环以北，惠新东街与北土城东路交汇处西行200米路北","1室","79","","11.2000"
"台湖银河湾","通州","通州其它","东五环化工桥京津高速2A出口南行1000米（环勃海总部基地）","3室","146","1100",""
"棠颂别墅璟庐","亦庄开发区","亦庄开发区其它","鹿华路7号院（南海子公园北侧500米）","4室","250","1900",""
"首开保利欢乐大都汇","门头沟","冯村","石门营环岛北50米","","","","3.0000"
"中国铁建花语金郡","大兴","瀛海","南海子公园西侧(南五环旧忠桥向南第二个红绿灯西300米)","3室","150","1060","6.6000"
"北辰墅院1900","顺义","马坡","顺义区顺兴街11号院望尊园","3室","120","508","4.3000"
"中海北京世家","大兴","亦庄开发区其它","三海子东路与公园北环路交叉口(南海子公园北侧)","5室","370","2200","5.8000"
"东方蓝海中心","昌平","北七家","未来科技城南区内科技城路与南区一路交界处","3室","104","590","5.5000"
"顺鑫颐和天璟","顺义","顺义其它","新城右堤路与昌金路交汇处向北200米","3室","108","408",""
"顺鑫颐和天璟","顺义","顺义其它","新城右堤路与昌金路交汇处向北200米","3室","241","875",""
"誉天下盛寓","顺义","中央别墅区","顺义中央别墅区榆阳路与林荫路交叉口","","","","6.5000"
"未来公元","昌平","北七家","京承高速北七家出口800米路南","3室","104","635","6.0800"
"中粮天恒天悦壹号","丰台","西红门","南四环地铁新宫站南500米","4室","126","1030","8.2000"
"万科大都会滨江N2","通州","北关","京通快速北关桥东北角","3室","143","929","6.5000"
"香悦四季","顺义","马坡","北京市顺义区顺恒大街合景香悦四季西二区","4室","159","690",""
"K2十里春风","通州","通州其它","永乐店镇漷小路（永开路）与恒业二街交汇处","2室","73","199","2.8400"
"K2十里春风","通州","通州其它","永乐店镇漷小路（永开路）与恒业二街交汇处","3室","155","500",""
"紫辰院","丰台","岳各庄","岳各庄北桥东北角200米处","4室","266","3192","12.0000"
"天恒摩墅","房山","房山其它","周口店镇政府东200米","3室","134","350",""
"兴创荣墅","大兴","大兴其它","采育镇育胜街与福源路交叉口西侧350米路南","3室","240","850",""
"景粼原著","朝阳","中央别墅区","京密路与顺黄路交叉路口往西200米","4室","479","4000",""
"绿城西府海棠","石景山","石景山其它","隆恩寺路北人大附石景山分校西侧","3室","90","415","5.2024"
"颐璟万和","大兴","黄村火车站","新源大街4号线义和庄地铁向北约500米","3室","80","477","5.5016"
"泰禾金府大院","丰台","西红门","南四环地铁新宫站南800米","4室","175","1400",""
"华远裘马四季","门头沟","大峪","增产路16号院","3室","156","950","6.0000"
"懋源钓云台","丰台","玉泉营","西三环康庄东路于丰台东路交汇西南角, 康庄东路9号院","4室","251","3263",""
"V7九间堂","通州","潞苑","通燕高速耿庄桥北出口中化石油对面","4室","220","1700",""
"中国铁建万科翡翠长安","门头沟","门头沟其它","西长安街沿线与六环交汇处西南1.2公里处","3室","166","950","5.7000"
"电建金地华宸","门头沟","门头沟其它","长安街西延线南侧约500米","3室","180","1700","6.4000"
"北辰墅院1900","顺义","马坡","顺义区顺兴街11号院望尊园","4室","251","","4.3000"
"首创天阅西山","海淀","海淀北部新区","永丰路与北清路交汇处东北角，中关村壹号北","","180","",""
"利锦府府上","朝阳","东坝","东五环七棵树出口沿东坝中街向东1500米, 红松园北里18号院","4室","280","1700","6.0000"
"中骏西山天璟","门头沟","城子","西山永定楼北300米","4室","117","700","6.5000"
"泰禾昌平拾景园","昌平","南邵","地铁昌平线南邵站西100米","3室","210","1200",""
"国瑞熙墅","昌平","北七家","北七家镇定泗路与七北路交叉口东行200米","3室","314","1500",""
"住总香榭8号","朝阳","大望路","西大望路24号","3室","139","1450",""
"首创禧瑞山","顺义","马坡","牛栏山镇昌金路与右堤路交界处","3室","141","680",""
"观山源墅","房山","良乡","阳光北大街与多宝路交汇处西南（理工大学北校区西侧）","3室","92","420","4.7500"
"北京东湾","通州","万达","通惠北路88号","1室","58","","6.8500"
"华发中央公园","房山","良乡","北京市房山区良乡大学城站南900米","3室","85","365","4.1000"
"天恒水岸壹号","房山","良乡","良乡大学城西站地铁南侧400米，刺猬河旁","3室","184","1100",""
"观唐云鼎","密云","密云其它","密溪路39号院","4室","170","460",""
"北京城建国誉府","房山","长阳","地铁良乡大学城北站东北约1300米，文昌东路与阜盛东街交汇处","4室","143","1000","4.8000"
"御汤山熙园","昌平","昌平其它","小汤山疗养院西侧，紧邻安泗路，距离北六环61号出口约2000米","4室","300","1800",""
"华远和墅","大兴","大兴其它","南六环磁各庄桥沿南中轴向南2公里","5室","295","1580",""
"天资华府","房山","长阳","长阳CSD办公楼南侧（京港澳高速长阳出口西1000米）","5室","93","","4.2000"
"西山燕庐","门头沟","门头沟其它","长安街延线南约500米","3室","123","850","6.5000"
"北科建泰禾丽春湖院子","昌平","沙河","中关村北延新核心，沙河水库边（地铁昌平线沙河站向南800米）","5室","468","2700",""
"绿地海珀云翡","大兴","大兴其它","兴亦路京开高速东侧（黄村镇第一中心小学对面）","2室","102","690","7.0000"
"领秀翡翠墅","丰台","丰台其它","王佐镇长青路南侧, 长青路88号院","3室","137","668","5.1000"
"华润西山墅","门头沟","冯村","冯石环路7号院","4室","126","780",""
"北京怡园","昌平","东关","水库路与昌崔路交汇处向北1公里路东","3室","70","430","4.6000"
"运河铭著","通州","北关","商通大道与榆东一街交叉口，温榆河森林公园东500米","2室","100","460","4.6000"
"万年广阳郡九号","房山","长阳","长阳清苑南街与汇商东路交汇处西北角","3室","139","680","4.8500"
"檀香府","门头沟","门头沟其它","京潭大街与潭柘十街交叉口","3室","208","1060","5.5000"
"观山源墅","房山","良乡","阳光北大街与多宝路交汇处西南（理工大学北校区西侧）","3室","290","1200","4.7500"
"都丽华府","平谷","平谷其它","新平南路与林荫南街交汇处向西100米","2室","90","306",""
"中粮京西祥云","房山","长阳","地铁稻田站北800米，西邻京深路","4室","115","700","5.8000"
"丽景长安","门头沟","冯村","永定镇石龙西路与三石路交叉口向西200米南侧","3室","152","780","5.2000"
"中冶德贤公馆","大兴","旧宫","德贤东路6号院（南四环榴乡桥东南角800米）","3室","186","1250",""
"国锐金嵿","亦庄开发区","亦庄","荣华南路1号院","4室","285","2200","7.8000"
"华萃西山","门头沟","门头沟其它","永定镇地铁S1号线石厂西南700米","3室","85","440","4.7000"
"首开香溪郡","通州","通州其它","宋庄镇荷香街2号院","3室","90","410","4.5500"
"西山艺境华墅","门头沟","大峪","阜石路双峪路口西800米路南","4室","205","","4.2000"
"天润福熙大道","朝阳","北苑","清河营东路1号院, 清河营东路3号院","3室","199","1700","8.8000"
"西长安壹号","门头沟","门头沟其它","门头沟石龙北路与石龙东路交汇向北100米处","1室","42","","3.3000"
"元熙华府","丰台","宋家庄","东南三环东铁营桥向南600米","2室","62","750","8.2000"
"京贸国际公馆","通州","九棵树(家乐福)","怡乐中路299号院（广渠快速路二期出口向南1000米）","2室","91","",""
"凯德麓语","昌平","昌平其它","兴寿镇京承高速G11出口向西怀昌路北侧","3室","280","750","3.5000"
"招商雍合府","大兴","黄村中","兴业大街与清源西路交汇处西南角（地铁4号线清源路站西侧800米）","2室","84","460","5.5800"
"金隅·金麟府","大兴","大兴其它","博兴八路与兴海一街交叉口西北侧","3室","89","468","5.2695"
"住总正华·时代广场","大兴","天宫院","地铁4号线生物医药基地站南200米","","","","5.5000"
"天瑞宸章","朝阳","中央别墅区","京密路与顺黄路交叉路口西南方向1000米","4室","120","1500",""
"首创远洋·禧瑞春秋","朝阳","中央别墅区","孙河组团八号路与二号路交叉口东","4室","266","1610","6.8924"
"龙湾别墅","顺义","中央别墅区","后沙峪乡龙湾别墅","4室","218","1299",""
"熙湖悦著","房山","房山其它","大苑村收费站出口（良坨路桥）左行200米","2室","73","261","3.4000"
"招商都会湾","昌平","东关","内环西路招商都会中心","3室","88","400",""
"京贸国际城·峰景","通州","武夷花园","芙蓉东路1号（通燕高速通州新城出口路南）","1室","69","492","7.2000"
"通州万国城MOMA","通州","乔庄","果园环岛以东，运河西大街与玉桥西路交汇处","3室","112","800","7.1000"
"华润西山墅","门头沟","冯村","冯石环路7号院","4室","338","1850",""
"檀香府","门头沟","门头沟其它","京潭大街与潭柘十街交叉口","3室","124","480","5.0000"
"尊悦光华","朝阳","CBD","光华东里甲1号院3号楼","3室","133","1700",""
"东方太阳城","顺义","顺义其它","潮白河畔（顺义新城滨河森林公园西300米）","5室","411","2100",""
"壹亮马","朝阳","酒仙桥","驼房营南路，将府公园西侧","3室","171","1700","9.8000"
"中粮天恒天悦壹号","丰台","西红门","南四环地铁新宫站南500米","5室","220","1900",""
"中海云熙","大兴","大兴其它","魏善庄新城南中轴路东侧500米","3室","76","335","3.7700"
"大兴金茂悦","大兴","大兴其它","南中轴与龙江路交汇处东300米（世界月季公园北500米）","2室","74","291","3.7500"
"珠江阙","通州","武夷花园","运河文化广场东侧30米","4室","330","2450","7.3000"
"远洋五里春秋","石景山","石景山其它","五里坨黑石头路前行500m","4室","330","1300",""
"林肯时代","亦庄开发区","亦庄","荣华路与荣京西街交叉口西侧300米（荣京东街站西侧600米）","2室","103","","4.2000"
"公园十七区","顺义","后沙峪","中央别墅区火沙路和裕庆路交汇口北500米","3室","90","475","5.5711"
"通泰国际公馆","亦庄开发区","亦庄","科创十三街29号院（地铁亦庄线经海路站西南角 ）","1室","53","280","5.2000"
"首开熙悦观湖","房山","房山其它","房山区青龙湖镇中心区,西至魏各庄路,北至青龙湖管理处","3室","89","280",""
"中铁·诺德春风和院","丰台","花乡","丰台区白盆窑六圈路和樊羊路交汇处东南","3室","89","","6.7702"
"萬橡悦府","昌平","回龙观","昌平区京藏高速与北清路交汇口东2公里","2室","73","480","5.4197"
"观承别墅·大家","顺义","后沙峪","高丽营镇观承别墅·大家项目","","","",""
"葛洲坝中国府","丰台","玉泉营","丰台东路46号","3室","185","2000","12.5000"
"华萃西山","门头沟","门头沟其它","门头沟永定镇地铁S1号线石厂站西南700米","4室","135","780",""
"领秀翡翠墅","丰台","丰台其它","王佐镇长青路南侧, 长青路88号院","4室","270","1400",""
"奥园北京源墅","密云","密云其它","密关路与313省道交汇处","3室","110","250","2.3000"
"翡翠公园","昌平","北七家","北七家京承高速北七家出口向西3公里","4室","260","1300",""
"北京城建北京合院","顺义","顺义其它","燕京街与通顺路交汇口东800米(仁和公园南)","","120","600","4.7000"
"中骏西山天璟","门头沟","城子","永定楼北300米","4室","140","928","6.3000"
"观唐云鼎","密云","密云其它","密溪路39号院","4室","138","550","3.1000"
"北京城建琨廷","房山","窦店","窦店镇京港澳高速公路提香草堂出口往西侧1.4公里, 于庄路1号院","3室","85","448","2.8000"
"保利首开天誉","朝阳","东坝","东五环七棵树路口向东280米","3室","160","3800",""
"浅山香邑","顺义","顺义其它","林秀西路1号院二区, 浅香北街16号院","2室","89","280",""
"梵悦108","朝阳","CBD","建国路乙108号","1室","108","2300","15.0000"
"金融街金悦府","大兴","黄村火车站","4号线义和庄地铁站往北400米","2室","73","412","5.5016"
"中海丽春湖墅·温榆府","昌平","沙河","地铁昌平线沙河地铁站南600米","2室","89","460",""
"天竺悦府","顺义","天竺","天柱东路29号","3室","125","770","5.9500"
"北京城建海梓府","大兴","大兴其它","三海子东路与姜场街交汇处南150米","4室","280","1400",""
"新潮嘉园二期","通州","潞苑","潞苑南大街185号","1室","65","385","5.8500"
"朝青知筑","朝阳","常营","朝阳北路与东五环路交接处向东2公里","3室","121","1060","7.8000"
"中海云筑","大兴","天宫院南","京开高速庞各庄桥西1500米（庞各庄镇宏轩饺子馆儿对面）","3室","89","340",""
"中海云筑","大兴","天宫院南","京开高速庞各庄桥西1500米，团结路北（庞各庄镇宏轩饺子馆儿对面）","4室","266","860",""
"金地·大湖风华","房山","房山其它","北京市房山区青龙湖水上乐园东南角","1室","67","265",""
"金辰府","昌平","北七家","北五环定泗路北七家镇政府正南","3室","89","430","5.3000"
"葛洲坝北京紫郡兰园","海淀","海淀北部新区","北清路葛洲坝北京紫郡兰园","3室","89","","5.3000"
"首开琅樾二期","朝阳","中央别墅区","京密路与京平辅路交叉口西行1.5公里","4室","205","1280",""
"信达·国子郡","昌平","沙河","沙河镇北沙河中路与高教园附近","2室","79","384",""
"华业玫瑰东筑","通州","临河里","梨园南街与临河里路交汇处，通州地铁土桥站南行800米","1室","58","340","5.6000"
"珠光御景西园","丰台","丰台其它","长辛店长云路2号","3室","117","480","4.0000"
"和光尘樾","朝阳","东坝","东五环七棵树桥出口向东1.5千米","3室","220","1730","7.9800"
"融尚未来","昌平","北七家","未来科学城南区鲁瞳西路和南区三街交叉口西行50米","3室","138","800",""
"和光尘樾","朝阳","东坝","东五环七棵树桥出口向东1.5千米","5室","380","3800",""
"旭辉城","房山","房山其它","西南六环良乡出口往南约2公里","2室","75","260","3.5000"
"世茂西山龙胤","海淀","海淀北部新区","南沙河西路上庄大桥南口向西800米","5室","680","4000",""
"华润理想国","昌平","北七家","北七家镇立汤路与北清路交叉点向东800米北清路南侧","3室","90","440","4.9520"
"首开保利熙悦林语","大兴","瀛海","旧宫镇五环路与德贤路交叉口东150米","3室","220","1100",""
"中海丽春湖墅·温榆府","昌平","沙河","地铁昌平线沙河地铁站南600米","5室","304","1100",""
"祥云赋","顺义","后沙峪","京承高速6出口（中央别墅区）罗马环岛北800米","3室","90","490","5.5583"
"泰禾金府大院","丰台","西红门","南四环地铁新宫站南800米","4室","362","2400",""
"中海金樾和著","房山","房山其它","良常路官道路口西800米","3室","89","320","3.7000"
"金地悦风华","大兴","郁花园","广阳大街与春和路交口西南","3室","89","480","5.5000"
"和悦华锦","大兴","大兴其它","博兴八路与兴海一街交叉口西南侧100米","3室","89","460","5.2695"
"远洋五里春秋","石景山","石景山其它","五里坨黑石头路前行500m","3室","90","420","5.2024"
"和锦薇棠","朝阳","常营","黄渠东路与朝阳北路辅路交汇处","4室","178","1300","8.8000"
"首创·河著","顺义","顺义其它","京承高速 11出口（昌金路）向东900 米路北","4室","248","1400",""
"和悦华玺","昌平","北七家","北七家正北五环外，立汤路与北清路交汇处东行800米","3室","89","450","4.9800"
"观承·望溪","顺义","后沙峪","高白路观承·望溪","4室","130","",""
"保利和光逸境","丰台","青塔","丰台区西四环中路83号","4室","108","1600",""
"西山上品湾MOMA","昌平","昌平其它","昌平区阳坊镇温南路与阳八路交汇处","3室","130","487","3.7500"
"京投发展公园悦府","昌平","回龙观","地铁8号线平西府站向东200米, 龙锦一街37号院","2室","86","495",""
"天恒世界集","大兴","郁花园","盛坊路1号院","0室","46","","5.5000"
"御世佳府","通州","潞苑","朝阳北路延长线北侧","4室","222","1300",""
"MAHA缦合北京","朝阳","燕莎","将台街道霄云路8号","4室","450","7000","13.5000"
"阳光城君山墅","密云","密云其它","密溪路33号(水库风景区内)","3室","312","750","2.8000"
"公园懿府","丰台","西红门","公益西桥南行3500米","3室","115","980","7.4000"
"万科观承别墅","顺义","后沙峪","高丽营镇于庄机场北线高速与高白路交汇处向北1公里路西","","","",""
"富兴首府","朝阳","东坝","东坝路9号东北60米","3室","144","1250","8.5000"
"中铁诺德阅墅","顺义","中央别墅区","中央别墅区优山美地D区西北侧","4室","220","1200",""
"碧桂园世奥龙鼎","延庆","延庆其它","百泉路延庆碧桂园世奥龙鼎","3室","89","230",""
"城市之光·东望","通州","通州其它","东五环化工桥向东京津高速第一出口通马路向南约500米","2室","70","450","5.1585"
"合景天汇广场","顺义","马坡","顺义区昌金路与通顺路交汇处天汇广场售楼处","3室","89","330","3.8000"
"金地旭辉·江山风华","大兴","黄村中","地铁4号线清源路站西侧800米","3室","89","480","5.5800"
"丽景长安二期","门头沟","冯村","永定镇石龙西路与三石路交叉口向南200米西侧","4室","152","681","5.2000"
"山水文园五期","朝阳","十里河","弘燕东路与西大望路交叉口向东100米","2室","153","",""
"兴创屹墅","大兴","高米店南","双高路兴创屹墅小区, 高米店南里","5室","464","3200",""
"恒大华府","朝阳","东坝","东坝中街与单店北街交汇处西北侧","4室","271","2700","8.8000"
"天恒乐墅","房山","阎村","京港澳高速阎村出口西行1500米","4室","184","787",""
"中粮瑞府","朝阳","中央别墅区","香江北路向北1500米","5室","468","4600",""
"世茂国风长安","丰台","青塔","西四环边，莲石路旁","","","",""
"中铁华侨城和园","大兴","瀛海","南五环南海子公园西侧约500米","4室","198","1350","5.0000"
"水岸雁栖","怀柔","怀柔","京加路水岸雁栖","0室","56","278","3.4000"
"懋源·璟玺","朝阳","中央别墅区","孙河京密路与京平辅路交叉口西行1000米","4室","555","",""
"金隅学府","大兴","大兴其它","兴海路金隅学府","2室","82","374","5.2695"
"观承别墅·大家","顺义","后沙峪","高丽营镇京承高速8号出口路东","","","",""
"卓越万科翡翠山晓","石景山","石景山其它","石景山石门路东侧500米","3室","89","425",""
"金地·大湖风华","房山","房山其它","良坨路金地大湖风华","4室","139","540",""
"懋源·璟岳","丰台","玉泉营","南三环西路99号院","3室","218","2900",""
"懋源·璟岳","丰台","玉泉营","南三环西路99号院","4室","465","5500",""
"山屿西山著","海淀","海淀北部新区","北清路山屿湖","3室","225","1300","5.3000"
"台湖金茂悦","通州","通州其它","台湖镇亦庄新城惠民路与生态公园路交汇处","","80","400","5.0000"
"中国铁建国际公馆","大兴","大兴其它","博兴十路中国铁建国际公馆","2室","80","335","5.2590"
```

## 北京空气质量数据预处理
> 本次作业使用jupyter notebook进行数据的处理
### 汇总计算 PM 指数年平均值的变化情况
#### 导入csv文件
```python
import pandas as pd
df = pd.read_csv('BeijingPM20100101_20151231.csv')
```
导入结果预览

![image-20191201202725068](C:\Users\speci\AppData\Roaming\Typora\typora-user-images\image-20191201202725068.png)

#### 保留和PM值相关的列，并汇总计算平均值
```python
import numpy as np
s_col = df.columns[1:3].append(df.columns[6:10])
org_data = df.loc[:, s_col].copy()    #选取需要的列
org_data
# 清除指定的列全为空的行，dropna参数中axis = 0表示删除行，how = 'all' 表示全为空才删，subset表示针对那几列判空，inplace为真表示是否在原数据上操作，此处要复制到新的dataframe中去，故设为假
cln_data = org_data.dropna(axis = 0, how = 'all', subset = ['PM_Dongsi', 'PM_Dongsihuan', 'PM_Nongzhanguan', 'PM_US Post']).copy()
cln_data.loc[:, 'PM_AVG'] = np.nan
for i in cln_data.index:
    cnt_not_null = 0
    PM_sum = 0
    for j in cln_data.columns[2:6]:
        if not np.isnan(cln_data.loc[i, j]):
            cnt_not_null += 1
            PM_sum += cln_data.loc[i, j]
    cln_data.loc[i, 'PM_AVG'] = PM_sum / cnt_not_null
```
结果

![image-20191201202929913](C:\Users\speci\AppData\Roaming\Typora\typora-user-images\image-20191201202929913.png)

#### 将清理后得到的数据按照年汇总得到每年的PM平均值
```python
grouped = cln_data['PM_AVG'].groupby(cln_data['year']).mean()
```

![image-20191201203055998](C:\Users\speci\AppData\Roaming\Typora\typora-user-images\image-20191201203055998.png)

#### 将结果绘制成折线图
```python
%matplotlib notebook
import matplotlib.pyplot as plt
plt.plot(grouped)
```

![image-20191201203232183](C:\Users\speci\AppData\Roaming\Typora\typora-user-images\image-20191201203232183.png)

### 汇总计算每年中1-12月的PM指数数据变化情况
对于每年的数据按照月分组，计算出每月的PM平均值，之后将六年的数据绘制成折线图
```python
fig = plt.figure()
fig_list = []
for x in range(1, 7):
    ax = fig.add_subplot(2, 3, x)
    fig_list.append(ax)

def monthly(year, data):
    data = data[data['year'] == year]
    monthly_grouped = data['PM_AVG'].groupby(data['month']).mean()
    return monthly_grouped
year = 2010
month_tick = []
for x in range (1, 13):
    month_tick.append(x)
# month_label = filter(str, month_tick)
for x in fig_list:
    x.plot(monthly(year, cln_data))
    x.set_title(str(year))
    x.set_xticks(month_tick)
    x.set_xticklabels(month_tick, rotation = 30, fontsize = 'small')
    
    year += 1
```
结果如下

![image-20191201203511527](C:\Users\speci\AppData\Roaming\Typora\typora-user-images\image-20191201203511527.png)
六年各自的汇总数据如下
##### 2010年
```
month
1      90.403670
2      97.239940
3      94.046544
4      80.072423
5      87.071913
6     109.038938
7     123.426075
8      97.683432
9     122.792735
10    118.784367
11    138.384036
12     97.115747
```
##### 2011年
```
month
1      44.873700
2     150.290179
3      57.991987
4      91.720670
5      65.108146
6     108.794655
7     107.386486
8     103.733800
9      94.969402
10    145.556818
11    109.434965
12    108.721400
```
##### 2012年
```
month
1     118.922388
2      84.442029
3      96.474324
4      87.835883
5      90.966715
6      96.634181
7      80.649709
8      81.165329
9      59.952247
10     94.951351
11     87.436963
12    109.187296
```
##### 2013年
```
month
1     183.195270
2     113.566468
3     114.572693
4      63.047801
5      89.148522
6     111.354861
7      74.932839
8      67.923611
9      85.717824
10    102.208781
11     85.146296
12     90.317764
```
##### 2014年
```
month
1     107.911738
2     160.513889
3     103.183244
4      92.160648
5      64.958557
6      59.154630
7      91.799955
8      65.668237
9      68.232639
10    135.269713
11    106.337500
12     76.622536
```
##### 2015年
```
month
1     110.022737
2     103.445561
3      94.483423
4      79.396991
5      61.167563
6      60.332407
7      60.229503
8      45.896057
9      50.924769
10     77.257841
11    125.803125
12    162.178987
```
